<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‘ë”ì§€ ê²Œì„</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    header {
      padding: 10px;
      background-color: #f0f0f0;
      font-size: 18px;
    }

    #startBtn, #rankingBtn {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
    }

    #levelDisplay {
      font-weight: bold;
      margin-top: 5px;
    }

    .holes {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: 5px;
      padding: 10px;
      width: 100vw;
      height: calc(100vh - 180px);
      box-sizing: border-box;
    }

    .hole {
      width: 100%;
      aspect-ratio: 1 / 1;
      background-color: #ccc;
      position: relative;
      border-radius: 50%;
      overflow: hidden;
    }

    .mole {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('mole.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      border-radius: 50%;
      cursor: pointer;
      pointer-events: auto;
    }

    #rankingModal {
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 400px;
      background: white;
      border: 2px solid #888;
      border-radius: 10px;
      padding: 20px;
      display: none;
      z-index: 1000;
    }

    #rankingModal h3 {
      margin-top: 0;
    }

    #rankingContent {
      min-height: 100px;
    }

    #rankingControls {
      margin-top: 10px;
    }

    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.5);
      display: none;
      z-index: 999;
    }

    #countdown {
      font-size: 48px;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>
<header>
  <h1>ë‘ë”ì§€ ì¡ê¸°!</h1>
  <p id="instruction">ğŸ® ì‹œì‘ì„ ëˆŒëŸ¬ ë ˆë²¨ì„ ì„ íƒí•˜ì„¸ìš”</p> <!-- ğŸ‘ˆ ì•ˆë‚´ ë¬¸êµ¬ ì¶”ê°€ -->
  <div id="levelDisplay">ë ˆë²¨: 1</div>

  <label for="levelSelect">ë‚œì´ë„ ì„ íƒ:</label>
  <select id="levelSelect">
    <option value="1">ë ˆë²¨ 1</option>
    <option value="2">ë ˆë²¨ 2</option>
    <option value="3">ë ˆë²¨ 3</option>
    <option value="4">ë ˆë²¨ 4</option>
    <option value="5">ë ˆë²¨ 5</option>
  </select>

  <button id="startBtn">ê²Œì„ ì‹œì‘</button>
  <button id="rankingBtn">ë­í‚¹ í™•ì¸</button>
  <p>ì ìˆ˜: <span id="score">0</span></p>
  <p>ë‚¨ì€ ì‹œê°„: <span id="time">30</span>ì´ˆ</p>
  <div id="countdown"></div>
</header>

  <div class="holes" id="holesContainer"></div>

  <div id="overlay"></div>
  <div id="rankingModal">
    <h3>ë‚œì´ë„ <span id="rankingLevel">1</span> ë­í‚¹</h3>
    <div id="rankingContent"></div>
    <div id="rankingControls">
      <button id="prevLevel">â† ì´ì „</button>
      <button id="nextLevel">ë‹¤ìŒ â†’</button>
      <button id="closeRanking">ë‹«ê¸°</button>
    </div>
  </div>

  <script>
    let score = 0;
    let timeLeft = 30;
    let gameInterval;
    let timerInterval;
    let level = 1;
    const scoreDisplay = document.getElementById('score');
    const timeDisplay = document.getElementById('time');
    const startBtn = document.getElementById('startBtn');
    const rankingBtn = document.getElementById('rankingBtn');
    const holesContainer = document.getElementById('holesContainer');
    const levelDisplay = document.getElementById('levelDisplay');
    const countdownDisplay = document.getElementById('countdown');
    const overlay = document.getElementById('overlay');
    const rankingModal = document.getElementById('rankingModal');
    const rankingContent = document.getElementById('rankingContent');
    const rankingLevel = document.getElementById('rankingLevel');
    const prevLevelBtn = document.getElementById('prevLevel');
    const nextLevelBtn = document.getElementById('nextLevel');
    const closeRankingBtn = document.getElementById('closeRanking');
    const rankings = { 1: [], 2: [], 3: [], 4: [], 5: [] };

    function createHoles(count) {
      holesContainer.innerHTML = '';
      for (let i = 0; i < count; i++) {
        const hole = document.createElement('div');
        hole.classList.add('hole');
        hole.id = `hole${i + 1}`;
        holesContainer.appendChild(hole);
      }
    }

    function randomHole() {
      const holes = document.querySelectorAll('.hole');
      const index = Math.floor(Math.random() * holes.length);
      return holes[index];
    }

    function showMoles() {
      const maxMoles = { 1: 1, 2: 2, 3: 2, 4: 3, 5: 5 }[level];
      const moleCount = Math.floor(Math.random() * maxMoles) + 1;

      for (let i = 0; i < moleCount; i++) {
        const hole = randomHole();
        const mole = document.createElement('div');
        mole.classList.add('mole');

        function hitMole(e) {
          e.preventDefault();
          score++;
          scoreDisplay.textContent = score;
          mole.remove();
        }

        mole.addEventListener('click', hitMole);
        mole.addEventListener('touchstart', hitMole, { passive: false });

        hole.appendChild(mole);

        setTimeout(() => {
          mole.remove();
        }, 1500);
      }
    }

    function startCountdown(callback) {
      countdownDisplay.textContent = `ë ˆë²¨ ${level} ì‹œì‘í•©ë‹ˆë‹¤`;
      let count = 3;
      const interval = setInterval(() => {
        countdownDisplay.textContent = count;
        count--;
        if (count < 0) {
          clearInterval(interval);
          countdownDisplay.textContent = '';
          callback();
        }
      }, 1000);
    }

    function startGame() {
      score = 0;
      timeLeft = 30;
      scoreDisplay.textContent = score;
      timeDisplay.textContent = timeLeft;
      levelDisplay.textContent = `ë ˆë²¨: ${level}`;
      startBtn.disabled = true;

      const holeCounts = { 1: 7, 2: 15, 3: 25, 4: 30, 5: 40 };
      createHoles(holeCounts[level]);

      gameInterval = setInterval(showMoles, 800);
      timerInterval = setInterval(() => {
        timeLeft--;
        timeDisplay.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(gameInterval);
          clearInterval(timerInterval);
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      alert(`ê²Œì„ ì¢…ë£Œ! ë‹¹ì‹ ì˜ ì ìˆ˜ëŠ” ${score}ì ì…ë‹ˆë‹¤.`);
      const nickname = prompt("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”:");
      if (nickname) {
        rankings[level].push({ name: nickname, score });
        rankings[level].sort((a, b) => b.score - a.score);
      }

            if (level < 5) {
        const next = confirm("ë‹¤ìŒ ë ˆë²¨ë¡œ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
        if (next) {
          level++;
          levelDisplay.textContent = `ë ˆë²¨: ${level}`;
          startCountdown(startGame);
          return;
        }
      }

      startBtn.disabled = false;
    }

    function showRanking(levelNum) {
      rankingLevel.textContent = levelNum;
      const entries = rankings[levelNum];
      rankingContent.innerHTML = '';

      if (entries.length === 0) {
        rankingContent.innerHTML = `<p>ê¸°ë¡ ì—†ìŒ</p>`;
      } else {
        entries.forEach((entry, idx) => {
          rankingContent.innerHTML += `<p>${idx + 1}. ${entry.name} - ${entry.score}ì </p>`;
        });
      }

      overlay.style.display = 'block';
      rankingModal.style.display = 'block';
    }

    startBtn.addEventListener('click', () => {
      level = parseInt(document.getElementById('levelSelect').value);
      levelDisplay.textContent = `ë ˆë²¨: ${level}`;
      startCountdown(startGame);
    });


    rankingBtn.addEventListener('click', () => {
      showRanking(level);
    });

    prevLevelBtn.addEventListener('click', () => {
      if (level > 1) {
        level--;
        showRanking(level);
      }
    });

    nextLevelBtn.addEventListener('click', () => {
      if (level < 5) {
        level++;
        showRanking(level);
      }
    });

    closeRankingBtn.addEventListener('click', () => {
      overlay.style.display = 'none';
      rankingModal.style.display = 'none';
    });
  </script>
</body>
</html>
